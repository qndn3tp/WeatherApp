# 이 워크플로우의 이름
name: Weather App Build

# 언제 실행할지 정하기
on:
  push:
    branches: [ main ]

# 할 일들
jobs:
  build:
    runs-on: macos-latest
    
    steps:
    # 1단계: 코드 다운로드
    - name: 📥 코드 다운로드하기
      uses: actions/checkout@v4
      
    # 2단계: Xcode 설정
    - name: ⚙️ Xcode 설정
      run: |
        sudo xcode-select -switch /Applications/Xcode_15.0.app/Contents/Developer
        echo "=== Xcode 버전 ===" 
        xcodebuild -version
        echo ""
        echo "=== 사용 가능한 시뮬레이터 ==="
        xcrun simctl list devices available | head -10
      
    # 3단계: 프로젝트 정보 확인
    - name: 📋 Weather 프로젝트 스킴 확인
      run: |
        echo "=== Weather.xcodeproj 스킴 정보 ==="
        xcodebuild -list -project Weather.xcodeproj
        echo ""
        echo "=== 빌드 설정 확인 ==="
        xcodebuild -showBuildSettings -project Weather.xcodeproj -scheme Weather | head -20
    
    # 4단계: CocoaPods 확인 (혹시 있다면)
    - name: 📦 의존성 확인
      run: |
        if [ -f "Podfile" ]; then
          echo "Podfile 발견! CocoaPods 설치 중..."
          sudo gem install cocoapods
          pod install
        else
          echo "Podfile 없음 - 순수 iOS 프로젝트입니다 ✅"
        fi
        
        if [ -f "Package.swift" ] || [ -f "*.xcodeproj/project.xcworkspace/xcshareddata/swiftpm" ]; then
          echo "Swift Package Manager 의존성이 있는 것 같습니다"
        fi
    
    # 5단계: 실제 빌드! 🔨
    - name: 🔨 Weather 앱 빌드하기
      run: |
        echo "=== ⚡ Weather 앱 빌드 시작! ==="
        
        xcodebuild build           -project Weather.xcodeproj           -scheme Weather           -destination 'platform=iOS Simulator,name=iPhone 15,OS=latest'           -configuration Debug           CODE_SIGN_IDENTITY=""           CODE_SIGNING_REQUIRED=NO           ONLY_ACTIVE_ARCH=NO
        
        echo "=== ✅ 빌드 성공! ==="
    
    # 6단계: 빌드 결과물 확인
    - name: 📱 빌드 결과 확인
      run: |
        echo "=== 빌드된 앱 찾기 ==="
        find ~/Library/Developer/Xcode/DerivedData -name "Weather.app" -type d 2>/dev/null | head -5
        
        echo ""
        echo "=== DerivedData 폴더 크기 ==="
        du -sh ~/Library/Developer/Xcode/DerivedData 2>/dev/null || echo "DerivedData 없음"
    
    # 7단계: 성공 메시지! 🎉
    - name: 🎉 완료!
      run: |
        echo "🎉🎉🎉 축하합니다! 🎉🎉🎉"
        echo ""
        echo "✅ Weather 앱이 성공적으로 빌드되었습니다!"
        echo "✅ 코드에 컴파일 에러가 없습니다!"
        echo "✅ 프로젝트 설정이 올바릅니다!"
        echo "✅ iPhone 15 시뮬레이터에서 실행 가능합니다!"
        echo ""
        echo "이제 진짜 iOS 개발자처럼 CI/CD를 사용하고 있어요! 🚀"