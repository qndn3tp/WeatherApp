name: Weather App - Simple CI

# PRê³¼ main ë¸Œëœì¹˜ í‘¸ì‹œì—ì„œë§Œ ì‹¤í–‰
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  # ì½”ë“œ í’ˆì§ˆ + ë¹Œë“œ ì²´í¬ (ë‹¨ì¼ Jobìœ¼ë¡œ ê°„ì†Œí™”)
  quality-and-build:
    runs-on: macos-14
    
    steps:
    # 1. ê¸°ë³¸ ì„¤ì •
    - name: ğŸ“¥ ì½”ë“œ ë‹¤ìš´ë¡œë“œ
      uses: actions/checkout@v4
      
    - name: âš™ï¸ Xcode 16.2 ì„¤ì •
      uses: maxim-lobanov/setup-xcode@v1
      with:
        xcode-version: '16.2'

    # 2. ì˜ì¡´ì„± ì„¤ì¹˜
    - name: ğŸ“¦ ì˜ì¡´ì„± í™•ì¸ ë° ì„¤ì¹˜
      run: |
        if [ -f "Podfile" ]; then
          echo "ğŸ“¦ CocoaPods ì˜ì¡´ì„± ì„¤ì¹˜ ì¤‘..."
          sudo gem install cocoapods
          pod install --repo-update
        else
          echo "âœ… ìˆœìˆ˜ iOS í”„ë¡œì íŠ¸ - CocoaPods ì—†ìŒ"
        fi

   # 3. ì½”ë“œ í’ˆì§ˆ ê²€ì‚¬
    - name: ğŸ§¹ SwiftLint ê²€ì‚¬
      run: |
        echo "ğŸ§¹ CI í™˜ê²½ì—ì„œ ì½”ë“œ í’ˆì§ˆ ìµœì¢… ê²€ì¦ ì¤‘..."
        
        # SwiftLint ì„¤ì¹˜ (ë” ì•ˆì •ì ì¸ ë°©ì‹)
        if ! command -v swiftlint &> /dev/null; then
          echo "ğŸ“¦ SwiftLint ì„¤ì¹˜ ì¤‘..."
          brew update
          brew install swiftlint
        else
          echo "âœ… SwiftLint ì´ë¯¸ ì„¤ì¹˜ë¨: $(swiftlint version)"
        fi
        
        # SwiftLint ì‹¤í–‰
        echo "ğŸ” ì½”ë“œ ìŠ¤íƒ€ì¼ ê²€ì‚¬ ì‹œì‘..."
        swiftlint lint --path "Weather"        
        echo "âœ… SwiftLint ê²€ì‚¬ ì™„ë£Œ"
      # SwiftLint ì—ëŸ¬ê°€ ìˆì–´ë„ ë¹Œë“œëŠ” ê³„ì† ì§„í–‰
      continue-on-error: true

    # 4. ë¹Œë“œ í…ŒìŠ¤íŠ¸
    - name: ğŸ”¨ iOS ì•± ë¹Œë“œ í…ŒìŠ¤íŠ¸
      run: |
        echo "ğŸ”¨ Weather ì•± ë¹Œë“œ í…ŒìŠ¤íŠ¸ ì‹œì‘..."
        
        # í”„ë¡œì íŠ¸ íŒŒì¼ ìë™ ê°ì§€
        if [ -f "Weather.xcworkspace" ]; then
          PROJECT_FILE="Weather.xcworkspace"
          BUILD_FLAG="-workspace"
        else
          PROJECT_FILE="Weather.xcodeproj" 
          BUILD_FLAG="-project"
        fi
        
        echo "ğŸ“ í”„ë¡œì íŠ¸ íŒŒì¼: $PROJECT_FILE"
        echo "ğŸ¯ ì‹œë®¬ë ˆì´í„°ì—ì„œ ë¹Œë“œ í…ŒìŠ¤íŠ¸ ì¤‘..."
        
        # iOS ì‹œë®¬ë ˆì´í„°ìš© ë¹Œë“œ
        xcodebuild clean build           $BUILD_FLAG "$PROJECT_FILE"           -scheme Weather           -destination "generic/platform=iOS Simulator"           -configuration Debug           CODE_SIGN_IDENTITY=""           CODE_SIGNING_REQUIRED=NO           ONLY_ACTIVE_ARCH=YES

    # 5. í…ŒìŠ¤íŠ¸ ì‹¤í–‰ (í…ŒìŠ¤íŠ¸ íƒ€ê²Ÿì´ ìˆë‹¤ë©´)
    - name: ğŸ§ª ìœ ë‹› í…ŒìŠ¤íŠ¸ (ìˆë‹¤ë©´)
      run: |
        echo "ğŸ§ª ìœ ë‹› í…ŒìŠ¤íŠ¸ í™•ì¸ ì¤‘..."
        
        # í”„ë¡œì íŠ¸ íŒŒì¼ ê°ì§€
        if [ -f "Weather.xcworkspace" ]; then
          PROJECT_FILE="Weather.xcworkspace"
          BUILD_FLAG="-workspace"
        else
          PROJECT_FILE="Weather.xcodeproj" 
          BUILD_FLAG="-project"
        fi
        
        # í…ŒìŠ¤íŠ¸ íƒ€ê²Ÿì´ ìˆëŠ”ì§€ í™•ì¸
        if xcodebuild -list $BUILD_FLAG "$PROJECT_FILE" | grep -q "Test"; then
          echo "âœ… í…ŒìŠ¤íŠ¸ íƒ€ê²Ÿ ë°œê²¬! í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘..."
          xcodebuild test             $BUILD_FLAG "$PROJECT_FILE"             -scheme Weather             -destination "platform=iOS Simulator,name=iPhone 16,OS=18.1"             CODE_SIGN_IDENTITY=""             CODE_SIGNING_REQUIRED=NO
        else
          echo "â„¹ï¸  í…ŒìŠ¤íŠ¸ íƒ€ê²Ÿ ì—†ìŒ - ê±´ë„ˆëœ€"
        fi
      # í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨í•´ë„ ì›Œí¬í”Œë¡œìš°ëŠ” ê³„ì†
      continue-on-error: true

    # 6. ì„±ê³µ ë©”ì‹œì§€
    - name: ğŸ‰ ì™„ë£Œ!
      run: |
        echo ""
        echo "ğŸ‰âœ¨ğŸ‰âœ¨ğŸ‰âœ¨ğŸ‰âœ¨ğŸ‰âœ¨ğŸ‰âœ¨ğŸ‰"
        echo "âœ… Weather App CI ì„±ê³µ!"
        echo "ë¹Œë“œ ì—ëŸ¬ ì—†ìŒ"
        echo "ì½”ë“œ í’ˆì§ˆ ì²´í¬ ì™„ë£Œ"
